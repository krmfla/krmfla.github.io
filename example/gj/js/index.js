"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,a,o,i){try{var s=e[o](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,a)}function _asyncToGenerator(s){return function(){var e=this,i=arguments;return new Promise(function(t,r){var n=s.apply(e,i);function a(e){asyncGeneratorStep(n,t,r,a,o,"next",e)}function o(e){asyncGeneratorStep(n,t,r,a,o,"throw",e)}a(void 0)})}}var index_view=new Vue({el:"#app",data:{game:new Game,staticURL:"".concat(window.location.origin,"/gjunloveschool/static"),model:void 0,maxPredictions:void 0,result:[],videoDOM:void 0,canvasDOM:void 0,cameraTrack:null,scanInterval:null,showToCertificate:!1,houseInterval:null,houseActive:"",houseInit:!1,formValue:{phone:"",name:"",mail:"",language:!1,computer:!1,check:!1},apiLoading:!1,postSuccess:!1,regulationsStatus:!1,houseTimeout:null,showRule:!1},methods:{controlHouse:function(){var t=this,r=Object.keys(this.game.examHistory).filter(function(e){return null===t.game.examHistory[e]}),e=["shop-A","shop-B","shop-C","shop-D","shop-E","shop-F","shop-G"].filter(function(e){return r.includes(e)}),n=0;this.houseInit=!0,this.houseTimeout=setTimeout(function(){t.houseInterval=setInterval(function(){t.houseInit=!1,t.houseActive=e[n],n<e.length-1?n++:n=0},1e3)},1200)},setVH:function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"));e=750/1334/(window.innerWidth/window.innerHeight);e<1&&document.documentElement.style.setProperty("--scale","".concat(e))},sendReceiveCertificate:function(){if(localStorage.getItem("receiveCertificate"))return!1;localStorage.setItem("receiveCertificate",!0)},init:function(){var n=this;return _asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(n.staticURL,"/model.json"),r="".concat(n.staticURL,"/metadata.json"),e.next=4,tmImage.load(t,r);case 4:n.model=e.sent,n.maxPredictions=n.model.getTotalClasses(),n.scanInterval=setInterval(function(){n.predict()},10);case 7:case"end":return e.stop()}},e)}))()},predict:function(){var n=this;return _asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.model.predict(n.videoDOM);case 2:r=e.sent,n.getFrameFromVideo(),n.result.length=0,(t=n.result).push.apply(t,_toConsumableArray(r)),r=r[n.scanIndex].probability.toFixed(2),"not-yet"===n.game.scanStatus&&.7<=Number(r)&&(clearInterval(n.scanInterval),n.game.scanStatus="init",n.game.toAnimation());case 8:case"end":return e.stop()}},e)}))()},getFrameFromVideo:function(){var a=this;return _asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("getframe"),t=a.canvasDOM,r=a.videoDOM,t.width=r.videoWidth,t.height=r.videoHeight,(n=t.getContext("2d")).clearRect(0,0,t.width,t.height),n.save(),n.drawImage(r,0,0,r.videoWidth,r.videoHeight),n.restore();case 10:case"end":return e.stop()}},e)}))()},submitForm:function(){var n=this;return _asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n.apiLoading)return e.abrupt("return",!1);e.next=3;break;case 3:return e.next=5,n.grecaptcha("form");case 5:if(n.formValue.name){e.next=8;break}return alert("請輸入姓名"),e.abrupt("return",!1);case 8:if(n.formValue.phone){e.next=11;break}return alert("請輸入手機號碼"),e.abrupt("return",!1);case 11:if(n.formValue.mail){e.next=14;break}return alert("請輸入Emali"),e.abrupt("return",!1);case 14:if(n.formValue.check){e.next=17;break}return alert("請同意我已詳細閱讀並接受個資保護聲明"),e.abrupt("return",!1);case 17:if([n.formValue.language,n.formValue.computer].some(function(e){return e})){e.next=20;break}return alert("請選擇預約課程類別"),e.abrupt("return",!1);case 20:if(t={phone:n.formValue.phone,name:n.formValue.name,email:n.formValue.mail,courseType:""},n.formValue.language&&(t.courseType="外語課程"),n.formValue.computer&&(t.courseType="電腦課程"),n.formValue.language&&n.formValue.computer&&(t.courseType="外語課程,電腦課程"),r=/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/,/^09\d{8}$/.test(t.phone)){e.next=29;break}return alert("請輸入正確手機號碼"),e.abrupt("return",!1);case 29:if(r.test(t.email)){e.next=32;break}return alert("請輸入正確Email"),e.abrupt("return",!1);case 32:return n.apiLoading=!0,e.next=35,fetch("https://script.google.com/macros/s/AKfycbxDRSJDCzHDwd5VRWjUQRcLJdXNcylrhT94k96AkbhGMK8dWm-ybeh7KTK3CFcFHPh0aw/exec",{method:"POST",body:JSON.stringify(t)}).then(function(e){n.postSuccess=!0}).catch(function(e){alert("請稍後再嘗試")});case 35:n.apiLoading=!1,e.next=42;break;case 38:e.prev=38,e.t0=e.catch(0),n.apiLoading=!1,console.log(e.t0);case 42:case"end":return e.stop()}},e,null,[[0,38]])}))()},showRegulations:function(e){this.regulationsStatus=!0,e.stopPropagation()}},computed:{shopName:function(){var e;return null===(e=shopMapping[this.game.shop])||void 0===e?void 0:e.name},shopExamName:function(){var e;return null===(e=shopMapping[this.game.shop])||void 0===e?void 0:e.examName},shopDescription:function(){var e;return null===(e=shopMapping[this.game.shop])||void 0===e?void 0:e.examDescription},isShopD:function(){return"shop-D"==this.game.shop},preparTitle:function(){var e;return null===(e=preparMapping[this.game.shop])||void 0===e?void 0:e.title},preparDes1:function(){var e;return null===(e=preparMapping[this.game.shop])||void 0===e?void 0:e.des1},preparDes2:function(){var e;return null===(e=preparMapping[this.game.shop])||void 0===e?void 0:e.des2},preparYueLao:function(){var e;return null===(e=preparMapping[this.game.shop])||void 0===e?void 0:e.yueLaoName},examInfo:function(){return examMapping[this.game.shop]||{}},scanIndex:function(){return["shop-F","shop-C","shop-D","shop-A","shop-B","shop-E","shop-G"].indexOf(this.game.shop)},scanHeader:function(){var e;return null===(e=scanMapping[this.game.shop])||void 0===e?void 0:e.header},teachHeader:function(){if(4!==this.game.teachIndex)return teachMapping.header[this.game.teachIndex];var e=null===(e=teachMapping[this.game.shop])||void 0===e?void 0:e.lastHeader;return"還想學更多".concat(e,"？<br/>快到巨匠學習愛情必勝課程吧！")},teachBody:function(){var e,t=null===(e=teachMapping[this.game.shop])||void 0===e||null===(t=e.exercise[this.game.teachIndex])||void 0===t?void 0:t.body;return t||""},teachTitle:function(){var e=null===(e=teachMapping[this.game.shop])||void 0===e?void 0:e.title;return e||""},teachVoice:function(){var e,t=null===(e=teachMapping[this.game.shop])||void 0===e||null===(t=e.exercise[this.game.teachIndex])||void 0===t?void 0:t.voice;return t||""},result_character_path:function(){return"shop-D"===this.game.shop?null:resultMapping[this.game.shop][this.game.examHistory[this.game.shop]]},result_promo:function(){return"shop-D"===this.game.shop?null:resultMapping[this.game.shop]["store_".concat(this.game.examHistory[this.game.shop])]},result_highlight:function(){return"shop-D"===this.game.shop?null:resultMapping[this.game.shop].highlight},result_desc:function(){return"shop-D"===this.game.shop?null:resultMapping[this.game.shop].desc}},watch:{"game.step":function(e,t){var r=this;switch(["scanImage","teach"].includes(this.game.step)||(this.scanInterval&&"shop-D"===this.game.shop&&clearInterval(this.scanInterval),this.cameraTrack&&this.cameraTrack.stop(),this.game.initScan()),"scanImage"===t&&clearInterval(this.scanInterval),this.game.step){case"teach":this.game.teachIndex=0,this.$nextTick(function(){var e=r.game.shop.split("shop-")[1];"scanImage"!==t&&bodymovin.loadAnimation({container:document.getElementById("yue-lao-permanent"),path:"./static/".concat(e,"_Standby.json"),loop:!0})});break;case"map":if(this.houseInit=!1,this.houseTimeout&&clearTimeout(this.houseTimeout),this.houseInterval&&clearInterval(this.houseInterval),this.controlHouse(),0!==Object.values(this.game.examHistory).filter(function(e){return null===e}).length)break;this.showToCertificate=!0}"map"===t&&clearInterval(this.houseInterval)}},mounted:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(t=this).setVH(),window.addEventListener("resize",this.setVH),window.addEventListener("orientationchange",this.setVH),setTimeout(function(){n.setVH()},2e3),(r=JSON.parse(localStorage.getItem("examHistory")))&&(r["shop-D"]||(r["shop-D"]=null),t.game.examHistory=r),"reserve"===findGetParameter("source")&&(location.href.includes("?")&&history.pushState({},null,location.href.split("?")[0]),t.game.scenes="game",t.game.step="certificate",t.$nextTick(function(){n.game.draw_canvas()})),bodymovin.loadAnimation({container:document.getElementById("kv-yue-lao"),path:"./static/D_Standby_noname.json",loop:!0});case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()});