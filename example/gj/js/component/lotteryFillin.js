"use strict";Vue.component("lottery-fillin",{template:"#lotteryFillin",data:function(){return{type:"",mobile:"",userid:"",awardPaper:[{awardName:"c99_cash10000",path:"images/《能量不斷電終極大獎 現金99,999》中獎回覆函.doc"},{awardName:"c99_cash10000",path:"images/《補充能量獎週週抽 Nintendo Switch》中獎回覆函.doc"},{awardName:"c99_cash10000",path:"images/《百大鐵人排名獎 SONY PS4》中獎回覆函.doc"}],paper:null,fblogin:!1,fbData:{fbToken:"",fbId:"",fbName:"",fbPic:""},invNumber:"",awardItem:"",awardName:"",name:"",address:"",IdcardFront:null,IdcardBack:null,Bankbook:null,CertificatePhoto:null,agree:!1,imageShow:{IdcardFront:null,IdcardBack:null,Bankbook:null,CertificatePhoto:null}}},watch:{IdcardFront:function(){""==!this.IdcardFrontShow&&(document.querySelector("#frontpre p").style.display="none",document.querySelector("#frontpre img").style.opacity="1")},IdcardBack:function(){""==!this.IdcardBackShow&&(document.querySelector("#backpre p").style.display="none",document.querySelector("#backpre img").style.opacity="1")},Bankbook:function(){""==!this.BankbookShow&&(document.querySelector("#bankpre p").style.display="none",document.querySelector("#bankpre img").style.opacity="1")},CertificatePhotoShow:function(){""==!this.CertificatePhotoShow&&(document.querySelector("#certificatepre p").style.display="none",document.querySelector("#certificatepre img").style.opacity="1")}},methods:{readpoto:function(e){var t=this,a=e.target.files.item(0),n=e.target.id,e=new FileReader;e.addEventListener("load",function(e){"front"==n&&(t.imageShow.IdcardFront=e.target.result,t.IdcardFront=a);"back"==n&&(t.imageShow.IdcardBack=e.target.result,t.IdcardBack=a);"bank"==n&&(t.imageShow.Bankbook=e.target.result,t.Bankbook=a);"certificate"==n&&(t.imageShow.CertificatePhoto=e.target.result,t.CertificatePhoto=a)}),e.readAsDataURL(a)},postback:function(){var e=this;if(!e.loading){if(e.loading=!0,!e.name)return alert("請填入收件人"),void(e.loading=!1);if(!e.address)return alert("請填入地址"),void(e.loading=!1);if("FB"==e.type){if(!e.fbData.fbId)return alert("請先登入FB"),void(e.loading=!1)}else if("Invoice"==e.type&&!e.CertificatePhoto)return alert("請上傳發票正本電子檔"),void(e.loading=!1);if(!e.agree)return alert("請勾選我已詳閱"),void(e.loading=!1);e.grecaptcha("backfill").then(function(){return e.postRecipientinfo()}).catch(function(){alert("grecaptcha失效"),e.loading=!1})}},postRecipientinfo:function(){var t=this,a=new FormData(document.getElementById("backfill-form"));return a.append("captcha",t.reCaptcha),a.append("code",t.userid),a.append("referenceInfo",t.invNumber),a.append("campaignId",99),t.checkFormData(a),new Promise(function(e){t.projApi.post("/apiName/recipientinfo",a).then(function(e){e&&200===e.code?(t.loading=!1,alert("資料已送出，感謝您的參與！")):(t.loading=!1,alert("您並無資格領取此獎項。")),window.location.href="./index.html"}).catch(function(e){t.loading=!1,alert("資料儲存失敗, 請重新再試")})})},fbLogin:function(){var t=this;FB.login(function(e){"connected"===e.status&&(t.fbData.fbToken=e.authResponse.accessToken,t.fbData.fbId=e.authResponse.userID,FB.api("/me","GET",{fields:"id,name,picture"},function(e){t.fbData.fbName=e.name,t.fbData.fbPic="http://graph.facebook.com/"+e.id+"/picture?width=140&height=140",t.fblogin=!0}))})},getRecipientinfo:function(){var a=this;return new Promise(function(t){a.projApi.get("/apiName/recipientinfo/".concat(a.userid)).then(function(e){e&&e.success?(a.mobile=e.data.mobile,a.invNumber=e.data.referenceInfo,a.awardItem=e.data.awardCode,a.awardName=e.data.awardName,a.type=e.data.referenceType,t()):(alert("資料已回填或無法查獲此獎項"),window.location.href="./index.html")})})},checkPaper:function(){var t=this;t.awardPaper.forEach(function(e){if(t.awardItem==e.awardName)return t.paper=e})}},mounted:function(){var e=this;e.userid=findGetParameter("user"),e.getRecipientinfo().then(function(){e.checkPaper()})}});