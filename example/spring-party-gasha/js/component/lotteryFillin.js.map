{"version":3,"sources":["component/lotteryFillin.js"],"names":["Vue","component","template","type","data","mobile","userid","awardPaper","awardName","path","paper","fblogin","fbToken","fbId","fbName","fbPic","invNumber","awardItem","address","IdcardFront","Bankbook","IdcardBack","agree","CertificatePhoto","imageShow","watch","this","IdcardFrontShow","document","querySelector","style","display","opacity","CertificatePhotoShow","methods","vm","file","e","target","files","item","id","reader","FileReader","addEventListener","result","imgLoad","readAsDataURL","postback","loading","name","fbData","alert","grecaptcha","then","postRecipientinfo","res","success","window","location","href","postInfo","fbLogin","FB","login","authResponse","accessToken","userID","fields","apires","getRecipientinfo","Promise","resolve","getInfo","referenceInfo","referenceType","checkPaper","forEach","mounted","loadpage","findGetParameter"],"mappings":"aAAAA,IAAIC,UAAU,iBAAkB,CAC5BC,SAAU,iBADVD,KAAAA,WACAC,MAAU,CACJC,KAAAC,GACKC,OAAA,GACGC,OAAE,GAAEC,WAAA,CACA,CACAC,UAAA,eAENC,KAAA,sCACI,EAAW,CACHD,UAAA,kBACTC,KAAA,4CACC,EAAW,CACHD,UAAA,WACTC,KAAA,oCACC,GAGPC,MAAA,KACIC,QAAM,CAAA,EACXA,OAAc,CACNC,QAAA,GACGC,KAAI,GACHC,OAAA,GACAC,MAAE,EACVA,EACHC,UAAA,GACDA,UAAa,GACbC,KAAW,GACLC,QAAE,GACRA,YAAW,KACXC,WAAiB,KAAEC,SAAA,KACnBC,iBAAgB,KAAEC,MAAA,CAAA,EAClBF,UAAc,CAAED,YAAA,KAChBI,WAAsB,KAAEH,SAAA,KACjBG,iBAAK,IACZC,CACI,CAMZ,EACAC,MALY,CACAN,YAAA,WAEP,IAAA,CADGO,KACHC,kBAGUC,SAAEC,cAAA,aAAY,EAAAC,MAAAC,QAAA,OACZH,SAAIC,cAAA,eAAA,EAAAC,MAAAE,QAAA,IAET,EACAX,WAAA,WAEuB,IAAf,CADCQ,KACAA,iBAGLD,SAAAP,cAAY,YAAA,EAAAS,MAAAC,QAAA,OACXH,SAAIC,cAAA,cAAA,EAAAC,MAAAE,QAAA,IAET,EACAZ,SAAA,WAEuB,IAAf,CADCS,KACAA,eAGPD,SAAAR,cAAY,YAAA,EAAAU,MAAAC,QAAA,OACTH,SAAIC,cAAA,cAAA,EAAAC,MAAAE,QAAA,IAET,EACAC,qBAAA,WAEuB,IAAf,CADCJ,KACAA,uBAGjBI,SAAoBJ,cAAEI,mBAAY,EAAAH,MAAAC,QAAA,OACrBH,SAAIC,cAAA,qBAAA,EAAAC,MAAAE,QAAA,IAET,CAMZ,EACAE,QALYN,CACAA,SAAQ,SAACC,GACb,IAAAM,EAAAT,KACJU,EAAAC,EAAAC,OAAAC,MAAAC,KAAA,CAAA,EACHC,EAAAJ,EAAAC,OAAAG,GACQC,EAAA,IAAAC,WACGD,EAAAE,iBAAI,OAEJR,SAAgBG,GACA,SAATD,IACEH,EAAIQ,UAAUxB,YAAEkB,EAAAC,OAAAO,OACtBD,EAAAA,YAAuBR,GAGV,QAAXU,IACKX,EAAAX,UAASH,WAAAgB,EAAAC,OAAAO,OACZrB,EAAUL,WAAWiB,GAE5B,QAAAK,IACUN,EAAAX,UAAQJ,SAAAiB,EAAAC,OAAAO,OACXrB,EAAUH,SAAUe,GAE3B,eAAAK,IACUN,EAAAX,UAAQD,iBAAAc,EAAAC,OAAAO,OACXrB,EAAUJ,iBAAmBgB,EAEpC,CApBI,EAAEM,EAAAK,cAAAX,CAAA,CAqBN,EAMRY,SALexB,WACD,IAACD,EAAAA,KACP,GAAA,CAAAY,EAAAc,QAEP,GADGd,EAAAc,QAAA,CAAA,EACHd,EAAAe,KAKeA,GAAIf,EAAEjB,QAANgC,CAIP,GAAA,MAAAf,EAAAhC,MACOe,GAAO,CAAEiB,EAAAgB,OAAAtC,KAGb,OAFcuC,MAAA,QAAA,EAAAA,KACDjB,EAAAc,QAAK,CAAA,EAEtB,MAAC,GAAA,WAAAd,EAAAhC,MACc,CAAAgC,EAAIZ,iBAGD,OAFA6B,MAAK,YAAE,EAAPA,KACJjB,EAASc,QAAA,CAAA,GAiBnBd,EAAAb,MAMAa,EAAAkB,WAAA,UAAA,EAAAC,KAAA,WACAnB,EAAAoB,kBAAA,EAAAD,KAAA,SAAAE,GACJA,EAAAC,QAKAL,MAAA,eAAA,EAJeA,MAAA,aAAA,EACKM,OAAAC,SAAAC,KAAA,eACEzB,EAAAc,QAAA,CAAA,CAKXM,CAAAA,CACS,CAACE,GAhBjBL,MAAA,SAAA,EACAjB,EAAAc,QAAA,CAAA,EA3BJ,MAHUG,MAAS,OAAA,EACLjB,EAAGc,QAAK,CAAA,OANtBG,MAAAJ,QAAG,EACMb,EAAAc,QAAA,CAAA,CA8DjB,EACAM,kBAV2B,WAWvB,IAVoBH,EAAM1B,KAW1BmC,SAV2BF,CACLT,KAACD,EAAOC,IACd,EAAA,SAAA,EACFI,KAAA,SAAAE,GACJA,EAAAC,QAKGL,MAAA,eAAA,EAJTA,MAAA,aAAA,EACJM,OAAAC,SAAAC,KAAA,eACHzB,EAAAc,QAAA,CAAA,CAOW,CAACO,CAUb,EACAM,QATYJ,WACE,IAACT,EAAOvB,KACbqC,GAAMC,MAAA,SAAAR,GAEoB,cAAhBG,EAAAA,SACGxB,EAAGgB,OAAKvC,QAAA4C,EAAAS,aAAAC,YACtB/B,EAAAgB,OAAAtC,KAAA2C,EAAAS,aAAAE,OAGDJ,GAAAD,IAAAA,MAAG,MAAA,CACOM,OAAA,iBACJ,EACN,SAAAC,GAEsBlC,EAAGqB,OAAIS,OAAaC,EAAAA,KAW7B/B,EAAGgB,OAAOpC,MAAQ,6BAA+BsD,EAAO5B,GAAK,gCARrEN,EAAAxB,QAAA,CAAA,CACc,CACE,EAGR,CAAA,CASpB,EACA2D,iBARoB,WACAnC,IAAGgB,EAAMzB,KACTS,OAAGxB,IAAO4D,QAAO,SAAAC,GAExBC,QAAA,GAAA,UAAAtC,EAAA7B,MAAA,EACLgD,KAAA,SAAAE,GACFA,EAAAC,SAIgBtB,EAAC9B,OAASmE,EAAAA,KAAQnE,OACrB8B,EAAAnB,UAAaV,EACvBgD,KAAKoB,cACOjB,EAAOxC,UAAEuC,EAAApD,KAAAI,UACR2B,EAAAhC,KAAgBqD,EAAApD,KAAAuE,cACfhB,EAAa,IARnCP,MAAA,eAAA,EACiBM,OAAAY,SAAAA,KAAAA,eASCjE,CAAAA,CACH8B,CAAAA,CAOhB,EACAyC,WANuB,WACPJ,IAAAA,EAAS9C,KACbS,EAAA5B,WAAAsE,QAAA,SAAArC,GACF,GAAAL,EAAAlB,WAAAuB,EAAAhC,UACJ,OAAA2B,EAAAzB,MAAA8B,CAENoC,CAAAA,CACI,CAOR,EACAE,QANgB3C,WAOZ,IANYA,EAAOA,KAEb4C,SAAA,MAAA,EACN5C,EAAA7B,OAAA0E,iBAAA,MAAA,EACH7C,EAAAmC,iBAAA,EAAAhB,KAAA,WACQnB,EAAAyC,WAAAE,CACD3C,CAAAA,CACJ,CAOR,CAAC","file":"lotteryFillin.js","sourcesContent":["Vue.component('lottery-fillin', {\r\n    template: \"#lotteryFillin\",\r\n    data: function () {\r\n        return {\r\n            type: \"\", // Invoice\" or FB\r\n            mobile: \"\",\r\n            userid: \"\",\r\n            awardPaper: [\r\n                {\r\n                    \"awardName\": \"現金 NT.99,999\",\r\n                    \"path\": \"images/《能量不斷電終極大獎 現金99,999》中獎回覆函.doc\"\r\n                }, {\r\n                    \"awardName\": \"Nintendo Switch\",\r\n                    \"path\": \"images/《補充能量獎週週抽 Nintendo Switch》中獎回覆函.doc\"\r\n                }, {\r\n                    \"awardName\": \"SONY PS4\",\r\n                    \"path\": \"images/《百大鐵人排名獎 SONY PS4》中獎回覆函.doc\"\r\n                },\r\n            ],\r\n            paper: null,\r\n            fblogin: false,\r\n            fbData: {\r\n                fbToken: \"\",\r\n                fbId: \"\",\r\n                fbName: \"\",\r\n                fbPic: \"\",\r\n            },\r\n            invNumber: \"\",\r\n            awardItem: \"\",\r\n            name: \"\",\r\n            address: \"\",\r\n            IdcardFront: null, //正面\r\n            IdcardBack: null, //反面\r\n            Bankbook: null, //存摺\r\n            CertificatePhoto: null, //發票\r\n            agree: false,\r\n            imageShow: {\r\n                \"IdcardFront\": null,\r\n                \"IdcardBack\": null,\r\n                \"Bankbook\": null,\r\n                \"CertificatePhoto\": null\r\n            },\r\n        }\r\n    },\r\n    watch: {\r\n        IdcardFront: function () {\r\n            var vm = this;\r\n            if (!vm.IdcardFrontShow == \"\") {\r\n                // $(\"#frontpre p\").css(\"display\", \"none\");\r\n                // $(\"#frontpre img\").css(\"opacity\", \"1\");\r\n                document.querySelector('#frontpre p').style.display = 'none';\r\n                document.querySelector('#frontpre img').style.opacity = '1';\r\n            }\r\n        },\r\n        IdcardBack: function () {\r\n            var vm = this;\r\n            if (!vm.IdcardBackShow == \"\") {\r\n                // $(\"#backpre p\").css(\"display\", \"none\");\r\n                // $(\"#backpre img\").css(\"opacity\", \"1\");\r\n                document.querySelector('#backpre p').style.display = 'none';\r\n                document.querySelector('#backpre img').style.opacity = '1';\r\n            }\r\n        },\r\n        Bankbook: function () {\r\n            var vm = this;\r\n            if (!vm.BankbookShow == \"\") {\r\n                // $(\"#bankpre p\").css(\"display\", \"none\");\r\n                // $(\"#bankpre img\").css(\"opacity\", \"1\");\r\n                document.querySelector('#bankpre p').style.display = 'none';\r\n                document.querySelector('#bankpre img').style.opacity = '1';\r\n            }\r\n        },\r\n        CertificatePhotoShow: function () {\r\n            var vm = this;\r\n            if (!vm.CertificatePhotoShow == \"\") {\r\n                // $(\"#certificatepre p\").css(\"display\", \"none\");\r\n                // $(\"#certificatepre img\").css(\"opacity\", \"1\");\r\n                document.querySelector('#certificatepre p').style.display = 'none';\r\n                document.querySelector('#certificatepre img').style.opacity = '1';\r\n            }\r\n        },\r\n    },\r\n    methods: {\r\n        readpoto(e) { //input file onchange event\r\n            var vm = this;\r\n            var file = e.target.files.item(0);\r\n            var id = e.target.id;\r\n            var reader = new FileReader();\r\n            reader.addEventListener('load', imgLoad);\r\n            reader.readAsDataURL(file);\r\n\r\n            function imgLoad(e) {\r\n                if (id == \"front\") {\r\n                    vm.imageShow.IdcardFront = e.target.result;\r\n                    vm.IdcardFront = file;\r\n                }\r\n                if (id == \"back\") {\r\n                    vm.imageShow.IdcardBack = e.target.result;\r\n                    vm.IdcardBack = file;\r\n                }\r\n                if (id == \"bank\") {\r\n                    vm.imageShow.Bankbook = e.target.result;\r\n                    vm.Bankbook = file;\r\n                }\r\n                if (id == \"certificate\") {\r\n                    vm.imageShow.CertificatePhoto = e.target.result;\r\n                    vm.CertificatePhoto = file;\r\n                }\r\n            }\r\n        },\r\n        postback() {\r\n            var vm = this;\r\n            if (!vm.loading) {\r\n                vm.loading = true;\r\n                if (!vm.name) {\r\n                    alert(\"請填入收件人\");\r\n                    vm.loading = false;\r\n                    return\r\n                };\r\n                if (!vm.address) {\r\n                    alert(\"請填入地址\");\r\n                    vm.loading = false;\r\n                    return\r\n                };\r\n                if (vm.type == \"FB\") { \r\n                    if (!vm.fbData.fbId) {\r\n                        alert(\"請先登入FB\");\r\n                        vm.loading = false;\r\n                        return\r\n                    };\r\n                } else if (vm.type == \"Invoice\") {\r\n                    if (!vm.CertificatePhoto) {\r\n                        alert(\"請上傳發票正本電子檔\");\r\n                        vm.loading = false;\r\n                        return\r\n                    };\r\n                    // if(!vm.IdcardFront) {\r\n                    //     alert(\"請上傳身份證正面電子檔\");\r\n                    //     vm.loading = false;\r\n                    //     return\r\n                    // };\r\n                    // if(!vm.IdcardBack) {\r\n                    //     alert(\"請上傳身份證反面電子檔\");\r\n                    //     vm.loading = false;\r\n                    //     return\r\n                    // };\r\n                    // if(!vm.Bankbook) {\r\n                    //     alert(\"請上傳存摺電子檔\");\r\n                    //     vm.loading = false;\r\n                    //     return\r\n                    // };\r\n                }\r\n                if (!vm.agree) {\r\n                    alert(\"請勾選我已詳閱\");\r\n                    vm.loading = false;\r\n                    return\r\n                };\r\n                // vm.getToken().then(function () {\r\n                    vm.grecaptcha(\"backfill\").then(function () {\r\n                        vm.postRecipientinfo().then(function (res) {\r\n                            if (!res.success) {\r\n                                alert(\"您並無資格領取此獎項。\");\r\n                                window.location.href = \"./index.html\";\r\n                                vm.loading = false;\r\n                            } else {\r\n                                alert(\"資料已送出，感謝您的參與！\");\r\n                                window.location.href = \"./index.html\";\r\n                                vm.loading = false;\r\n                            }\r\n                        });\r\n                    })\r\n                // })\r\n            }\r\n        },\r\n        postRecipientinfo: function() {\r\n            var vm = this;\r\n            postInfo({\r\n                name: vm.name,\r\n            }, 'apiName')\r\n            .then(function(res){\r\n                if (!res.success) {\r\n                    alert(\"您並無資格領取此獎項。\");\r\n                    window.location.href = \"./index.html\";\r\n                    vm.loading = false;\r\n                } else {\r\n                    alert(\"資料已送出，感謝您的參與！\");\r\n                    window.location.href = \"./index.html\";\r\n                    vm.loading = false;\r\n                }\r\n            })\r\n        },\r\n        fbLogin() {\r\n            var vm = this;\r\n            FB.login(function (res) {\r\n               // console.log(res);\r\n                if (res.status === 'connected') {\r\n                    vm.fbData.fbToken = res.authResponse.accessToken;\r\n                    vm.fbData.fbId = res.authResponse.userID;\r\n\r\n                    // 取得fb個人資料\r\n                    FB.api('/me', 'GET', {\r\n                            \"fields\": \"id,name,picture\"\r\n                        },\r\n                        function (apires) {\r\n                            // console.log(apires);\r\n                            vm.fbData.fbName = apires.name;\r\n                            // vm.fbData.fbPic = apires.picture.data.url;\r\n                            vm.fbData.fbPic = 'http://graph.facebook.com/' + apires.id + '/picture?width=140&height=140';\r\n                            vm.fblogin = true;\r\n                        }\r\n                    );\r\n                }\r\n            })\r\n        },\r\n        getRecipientinfo: function () {\r\n            var vm = this;\r\n            return new Promise(function(resolve){\r\n                getInfo('','apiName'+vm.userid)\r\n                .then(function(res){\r\n                    if (!res.success) {\r\n                        alert(\"資料已回填或無法查獲此獎項\");\r\n                        window.location.href = \"./index.html\";\r\n                    } else {\r\n                        vm.mobile = res.data.mobile;\r\n                        vm.invNumber = res.data.referenceInfo;\r\n                        vm.awardItem = res.data.awardName;\r\n                        vm.type = res.data.referenceType;\r\n                        resolve()\r\n                    }\r\n                })\r\n            })\r\n        },\r\n        checkPaper: function () { \r\n            var vm = this;\r\n            vm.awardPaper.forEach(function (item) { \r\n                if (vm.awardItem == item.awardName) {\r\n                    return vm.paper = item;\r\n                }\r\n            })\r\n        }\r\n    },\r\n    mounted: function () {\r\n        var vm = this;\r\n        // vm.readpic();\r\n        loadpage('init');\r\n        vm.userid = findGetParameter('user');\r\n        vm.getRecipientinfo().then(function () { \r\n            vm.checkPaper();\r\n        });\r\n    }\r\n});"]}