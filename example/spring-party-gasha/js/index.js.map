{"version":3,"sources":["index.js"],"names":["synth","window","speechSynthesis","index_view","data","stage","lucky_list","award_name","department","name","nickname","select_options","title","id","event_type","api_host","award_id","ajax_wait","show_setting","voices","options","voice_select","slicing","text","slice","handle_type_change","this","handle_focus","console","log","select_bar1","document","getElementById","select_bar2","vm","prepare","lottie","loadAnimation","path","renderer","container","autoplay","lottery_start","setSpeed","onComplete","defaults","headers","common","event","addEventListener","keyCode","get_options","get_start","play","reset","stop","skip_anime","display_prev","start_draw","call_draw_api","call_addition_api","alert","speech_init","aname","toUpperCase","sort","a","b","bname","option","i","length","concat","lang","speak_action","speaking","inputTxt","utterThis","error","SpeechSynthesisUtterance","onerror","pitch","onend","selectedOption","voiceSelect","getAttribute","voice","rate","value","post","configID","speak","response","message","_this2","axios","prizeTitle","then","err","nameList","call_reset_api","callback","mounted","confirm","is_ready","localStorage","getItem","host","init"],"mappings":"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","file":"index.js","sourcesContent":["const synth = window.speechSynthesis;\r\n\r\nvar index_view = new Vue({\r\n    el: \"#app\",\r\n    data: {\r\n        stage: 'prepare', // prepare, start, result\r\n        award_name: '',\r\n        lucky_list: [\r\n            {\r\n                department: '業務部',\r\n                name: '邱泯瑄',\r\n                nickname: 'Kelly'\r\n            },\r\n            {\r\n                department: '營運企劃',\r\n                name: '黃俞禎',\r\n                nickname: 'Irene'\r\n            },\r\n            {\r\n                department: '媒體部',\r\n                name: '洪卉俞',\r\n                nickname: 'Claire'\r\n            }\r\n        ],\r\n        select_options: [{id: 1, title: '一年以上貳獎'}],\r\n        event_type: 'regular', //regular, addition\r\n        award_id: null,\r\n        api_host: 'http://52.220.49.115:8090',\r\n        ajax_wait: false,\r\n        show_setting: false,\r\n        voices: [],\r\n        options: \"\",\r\n        voice_select: '',\r\n    },\r\n    methods: {\r\n        slicing(text) {\r\n            return text.slice(0, 12)\r\n        },\r\n        handle_type_change() {\r\n            this.award_id = null;\r\n            this.handle_focus();\r\n        },\r\n        handle_focus() {\r\n            console.log('handle_focus');\r\n            var select_bar1 = document.getElementById('select_bar1');\r\n            var select_bar2 = document.getElementById('select_bar2');\r\n            select_bar1.blur();\r\n            select_bar2.blur();\r\n        },\r\n        init() {\r\n            var vm = this;\r\n            this.prepare = lottie.loadAnimation({\r\n                path: \"static/gacha01.json\",\r\n                container: document.getElementById('lottery-prepare'),\r\n                renderer: 'svg',\r\n                loop: true,\r\n                autoplay: true\r\n            });\r\n            this.lottery_start = lottie.loadAnimation({\r\n                path: \"static/gacha02.json\",\r\n                container: document.getElementById('lottery-start'),\r\n                renderer: 'svg',\r\n                loop: false,\r\n                autoplay: false\r\n            });\r\n            this.lottery_start.setSpeed(1.5);\r\n            this.lottery_start.onComplete = function() {\r\n                console.log('complete');\r\n                vm.stage = 'result';\r\n            }\r\n            axios.defaults.headers.common['Authorization'] = 'Bearer 1234';\r\n\r\n            document.addEventListener('keydown', function(event) {\r\n                console.log(event.keyCode);\r\n                if (event.keyCode === 13) {\r\n                    vm.start_draw();\r\n                }\r\n            });\r\n\r\n            this.get_options();\r\n        },\r\n        get_start() {\r\n            this.stage = 'start';\r\n            this.lottery_start.play();\r\n            this.get_options();\r\n        },\r\n        reset() {\r\n            this.stage = 'prepare';\r\n            this.lottery_start.stop();\r\n            this.award_id = null;\r\n            this.ajax_wait = false;\r\n        },\r\n        skip_anime() {\r\n            this.stage = 'result';\r\n            this.lottery_start.stop();\r\n        },\r\n        get_options() {\r\n            var vm = this;\r\n            return;\r\n            axios.post(`${this.api_host}/getDrawConfigList`).then(response => {\r\n                vm.select_options = response.data.data;\r\n                console.log(response.data);\r\n            }).catch(err => {\r\n                alert(err);\r\n            })\r\n        },\r\n        display_prev() {\r\n            this.stage = 'result';\r\n        },\r\n        start_draw() {\r\n            // prevent double click\r\n            if (this.ajax_wait) {\r\n                return;\r\n            }\r\n            if (this.stage !== 'prepare') {\r\n                return;\r\n            }\r\n            if (this.event_type === 'regular' && !this.award_id) {\r\n                alert('尚未選擇抽獎項目');\r\n                return;\r\n            }\r\n            switch (this.event_type) {\r\n                case 'regular':\r\n                    this.call_draw_api();\r\n                    break;\r\n                case 'addition':\r\n                    this.call_addition_api();\r\n                    break;\r\n            }\r\n\r\n        },\r\n        // TODO:\r\n        speech_init() {\r\n            this.voices = synth.getVoices().sort(function (a, b) {\r\n                const aname = a.name.toUpperCase();\r\n                const bname = b.name.toUpperCase();\r\n            \r\n                if (aname < bname) {\r\n                  return -1;\r\n                } else if (aname == bname) {\r\n                  return 0;\r\n                } else {\r\n                  return +1;\r\n                }\r\n              });\r\n            //   const selectedIndex =\r\n            //     voiceSelect.selectedIndex < 0 ? 0 : voiceSelect.selectedIndex;\r\n            //   voiceSelect.innerHTML = \"\";\r\n            console.log(this.voices);\r\n            \r\n            for (let i = 0; i < this.voices.length; i++) {\r\n                var option = `<option data-lang=\"${this.voices[i].lang}\" data-name=\"${this.voices[i].name}\">`;\r\n                option += `${this.voices[i].name} (${this.voices[i].lang})`;\r\n            \r\n                if (this.voices[i].default) {\r\n                    option += \" -- DEFAULT\";\r\n                }\r\n                option += '</option>'\r\n                this.options += option;\r\n            }\r\n            console.log(this.options);\r\n            //   voiceSelect.selectedIndex = selectedIndex;\r\n        },\r\n        speak_action() {\r\n            if (synth.speaking) {\r\n                console.error(\"speechSynthesis.speaking\");\r\n                return;\r\n            }\r\n            var inputTxt = '業務部邱泯瑄, 營運企劃黃俞禎, 媒體部洪卉俞';\r\n            const utterThis = new SpeechSynthesisUtterance(inputTxt);\r\n        \r\n            utterThis.onend = function (event) {\r\n                console.log(\"SpeechSynthesisUtterance.onend\");\r\n            };\r\n        \r\n            utterThis.onerror = function (event) {\r\n                console.error(\"SpeechSynthesisUtterance.onerror\");\r\n            };\r\n        \r\n            const selectedOption =\r\n                voiceSelect.selectedOptions[0].getAttribute(\"data-name\");\r\n        \r\n            for (let i = 0; i < voices.length; i++) {\r\n                if (voices[i].name === selectedOption) {\r\n                utterThis.voice = voices[i];\r\n                break;\r\n                }\r\n            }\r\n            utterThis.pitch = pitch.value;\r\n            utterThis.rate = rate.value;\r\n            synth.speak(utterThis);\r\n            \r\n        },\r\n        call_draw_api() {\r\n            var vm = this;\r\n            vm.get_start();\r\n            return;\r\n            this.ajax_wait = true;\r\n            axios.post(`${this.api_host}/drawWithConfigID`, {configID: this.award_id}).then(response => {\r\n                // console.log(response);\r\n                var data = response.data;\r\n                if (data.message) {\r\n                    alert(data.message);\r\n                } else {\r\n                    vm.award_name = data.data.prizeTitle;\r\n                    vm.lucky_list = data.data.nameList;\r\n                    vm.get_start();\r\n                }\r\n                this.ajax_wait = false;\r\n            }).catch(err => {\r\n                this.ajax_wait = false;\r\n                console.error(err);\r\n            })\r\n        },\r\n        call_addition_api() {\r\n            var vm = this;\r\n            this.ajax_wait = true;\r\n            axios.post(`${this.api_host}/drawAdditional`).then(response => {\r\n                // console.log(response);\r\n                var data = response.data;\r\n                if (data.message) {\r\n                    alert(data.message);\r\n                } else {\r\n                    vm.award_name = data.data.prizeTitle;\r\n                    vm.lucky_list = data.data.nameList;\r\n                    vm.get_start();\r\n                }\r\n                this.ajax_wait = false;\r\n            }).catch(err => {\r\n                this.ajax_wait = false;\r\n                console.error(err);\r\n            })\r\n        },\r\n        call_reset_api() {\r\n            var vm = this;\r\n            var callback = function() {\r\n                axios.post(`${vm.api_host}/resetDraw`).then(response => {\r\n                    var data = response.data;\r\n                    if (data.message) {\r\n                        alert(data.message);\r\n                    }\r\n                });\r\n            }\r\n            var confirm = window.confirm('是否確認要重置獎項?');\r\n            if (confirm) {\r\n                callback();\r\n            }\r\n        }\r\n    },\r\n    mounted: function() {\r\n        var host = window.localStorage.getItem('api_host');\r\n        if (host) {\r\n            this.api_host = host;\r\n        }\r\n        this.init();\r\n        this.is_ready = true;\r\n        this.speech_init();\r\n    }\r\n})\r\n"]}