{"version":3,"sources":["index.js"],"names":["index_view","Vue","el","stage","award_name","select_options","id","title","event_type","award_id","ajax_wait","methods","text","slice","api_host","this","handle_focus","slicing","console","select_bar1","document","getElementById","handle_type_change","blur","log","select_bar2","loop","autoplay","prepare","loadAnimation","path","container","renderer","lottery_start","lottie","onComplete","vm","defaults","headers","common","event","keyCode","start_draw","get_start","play","get_options","stop","reset","skip_anime","then","response","data","err","alert","post","display_prev","call_draw_api","call_addition_api","_this","concat","configID","message","lucky_list","nameList","error","_this2","prizeTitle","call_reset_api","window","callback","axios","mounted","host","localStorage","getItem","confirm","init","is_ready"],"mappings":"aAAA,IAAIA,WAAa,IAAIC,IAAI,CACrBC,GAAI,OADJF,KAAAA,CACIG,MAAM,UACJC,WAAA,GACFD,WAAgB,GAgBZE,eAAA,CAAA,CAAAC,GAAA,EAAAC,MAAA,QAAA,GACAC,WAAA,UACHC,SAAA,KACDJ,SAAc,4BAAMK,UAAG,CAAA,CAK3B,EAL4CC,QAAE,CAC1CH,QAAU,SAAEI,GAAW,OAAAA,EAAAC,MAAA,EAAA,EAAA,CACvBJ,EACAK,mBAAU,WACVJ,KAAWD,SAAA,KACdM,KAAAC,aAAA,CACDL,EACIM,aAAO,WACHC,QAAYL,IAAM,cAAM,EAC3B,IAAAM,EAAAC,SAAAC,eAAA,aAAA,EACDC,EAAkBF,SAAAE,eAAG,aAAA,EACZb,EAAWc,KAAI,EACfP,EAAaO,KAAC,CACtB,EACDP,KAAAA,WACIE,IAAQM,EAAIT,KACRI,KAAAA,QAAcC,OAASC,cAAe,CACtCI,KAAW,sBACfN,UAAkBC,SAAAC,eAAA,iBAAA,EAClBI,SAAkB,MACrBC,KAAA,CAAA,EACGC,SAAG,CAAA,CACG,CAAA,EACDC,KAAAA,cAAiBC,OAAAA,cAAc,CAC1BC,KAAA,sBACNC,UAAmBX,SAACC,eAAe,eAAkB,EAC7CW,SAAO,MACTN,KAAI,CAAA,EACFC,SAAE,CAAA,CACZ,CAAA,EACGM,KAAAA,cAAgBC,SAAOL,IAAAA,EACpBd,KAAEkB,cAAAE,WAAqB,WAC3BJ,QAAWX,IAASC,UAAAA,EACZe,EAAEjC,MAAK,QACX,EACJwB,MAAUU,SAAAC,QAAAC,OAAA,cAAA,cAETN,SAAAA,iBAA2B,UAAC,SAAAO,GAC5BP,QAAaT,IAACW,EAAAA,OAAa,EACL,KAAXK,EAAAC,SACDL,EAAAM,WAAQ,CAEjBL,CAAAA,EAGFnB,KAAQM,YAAUiB,CAClB,EAORE,UANeD,WACP3B,KAAAZ,MAAA,QACFY,KAAAkB,cAAAW,KAAA,EAEGC,KAAAA,YAAa,CACrB,EACDF,MAAS,WACAxC,KAAKA,MAAG,UACR8B,KAAAA,cAAoBa,KAAA,EACpBD,KAAAA,SAAa,KACrB9B,KAAAL,UAAA,CAAA,CACDqC,EACIC,WAAU,WACLf,KAAAA,MAAca,SACdrC,KAAAA,cAAeqC,KAAA,CACpB,EACHD,YAAA,WACDG,IAAUZ,EAAArB,KAEDkB,MAAAA,KAAAA,GAAAA,OAAca,KAAMhC,SAAA,oBAAA,CAAA,EAAAmC,KAAA,SAAAC,GAC5Bd,EAAA/B,eAAA6C,EAAAC,KAAAA,KACUjC,QAAAM,IAAAqB,EAAAA,IAAG,CACJ,CAAA,EAAA,MAAO,SAAAO,GACbC,MAAAD,CAAA,CACME,CAAAA,CACFlB,EACAlB,aAAYgC,WACdnC,KAAMZ,MAAC,QACLkD,EACFX,WAAA,WAENa,GAAYxC,CAAAA,KAAAL,WAGFgC,YAAA3B,KAAAZ,MAGF,GAAA,YAAAY,KAAAP,YAAAO,KAAAN,SAIJ,OAAAM,KAAAP,YACSA,IAAAA,UACCO,KAAWyC,cAAA,EACjB,MACJ,IAAA,WACahD,KAAAA,kBAAU,CAEf,MAVR6C,MAAA,UAAA,CAYI,EAMRG,cALiBC,WAAAA,IAAAA,EAAAA,KACLrB,EAAArB,KACRqB,EAAAO,UAAA,EAGJa,KAAa9C,UAAA8C,CAAAA,EAAGE,MAAAJ,KAAA,GAAAK,OAAA5C,KAAAD,SAAA,mBAAA,EAAA,CAAA8C,SAAA7C,KAAAN,QAAA,CAAA,EAAAwC,KAAA,SAAAC,GAEEC,EAAAD,EAAAC,KACdA,EAAAU,QACcR,MAAGF,EAAIU,OAAA,GACsCzB,EAAK3B,WAAAA,EAAAA,KAAAA,WAAgB2B,EAAA0B,WAAYX,EAAAA,KAAAY,SACxF3B,EAAAO,UAAA,GAEQe,EAACG,UAAS,CAAA,CACdR,CAAAA,EAAAA,MAAWQ,SAAAA,GACRH,EAAAhD,UAAA,CAAA,EACAN,QAAU4D,MAAOZ,CAACD,CACnB,CAACW,CAQf,EANQL,kBAAA,WAAA,IAAAQ,EAAAlD,KACKL,EAAAA,KACPK,KAAML,UAAC0C,CAAAA,EACLM,MAAKhD,KAAAA,GAAAA,OAAYK,KAAKD,SAAA,iBAAA,CAAA,EAAAmC,KAAA,SAAAC,GAExBC,EAAAD,EAAAC,KACLA,EAAAU,QACDJ,MAAiBN,EAAAU,OAAAJ,GACArB,EAAAhC,WAAA+C,EAAAA,KAAAe,WACC9B,EAAG0B,WAAIX,EAAAA,KAAAY,SACXJ,EAAAA,UAAS7C,GAEPmD,EAAGf,UAAa,CAAA,CACpBC,CAAAA,EAAAA,MAAKU,SAAAA,GACCV,EAAKU,UAAQ,CAAA,EAChB3C,QAAA8C,MAAAZ,CAAA,CACD,CAAChD,CASf,EACA+D,eARwB,WAChB,IAAA/B,EAAArB,KASWqD,OAAXC,QAAsB,YAAA,GAPxBC,MAAOhB,KAAA,GAAAK,OAAAP,EAAOtC,SAAA,YAAA,CAAA,EAAAmC,KAAA,SAAAC,GACEC,EAAGD,EAAKC,KACRC,EAAIS,SACpBR,MAAAF,EAAAU,OAAA,CAENM,CAAAA,CAcA,CACJ,EACAI,QARc,WACL,IAAAC,EAAAJ,OAAAK,aAAAC,QAAA,UAAA,EACGC,IACAA,KAAO7D,SAAE0D,GAEbzD,KAAA6D,KAAA,EACJ7D,KAAA8D,SAAA,CAAA,CACH,CASL,CAAC","file":"index.js","sourcesContent":["var index_view = new Vue({\r\n    el: \"#app\",\r\n    data: {\r\n        stage: 'prepare', // prepare, start, result\r\n        award_name: '',\r\n        lucky_list: [\r\n            // {\r\n            //     department: '業務部',\r\n            //     name: '邱泯瑄',\r\n            //     nickname: 'Kelly'\r\n            // },\r\n            // {\r\n            //     department: '營運企劃',\r\n            //     name: '黃俞禎',\r\n            //     nickname: 'Irene'\r\n            // },\r\n            // {\r\n            //     department: '媒體部',\r\n            //     name: '洪卉俞',\r\n            //     nickname: 'Claire'\r\n            // }\r\n        ],\r\n        select_options: [{id: 1, title: '一年以上貳獎'}],\r\n        event_type: 'regular', //regular, addition\r\n        award_id: null,\r\n        api_host: 'http://52.220.49.115:8090',\r\n        ajax_wait: false\r\n    },\r\n    methods: {\r\n        slicing(text) {\r\n            return text.slice(0, 12)\r\n        },\r\n        handle_type_change() {\r\n            this.award_id = null;\r\n            this.handle_focus();\r\n        },\r\n        handle_focus() {\r\n            console.log('handle_focus');\r\n            var select_bar1 = document.getElementById('select_bar1');\r\n            var select_bar2 = document.getElementById('select_bar2');\r\n            select_bar1.blur();\r\n            select_bar2.blur();\r\n        },\r\n        init() {\r\n            var vm = this;\r\n            this.prepare = lottie.loadAnimation({\r\n                path: \"static/gacha01.json\",\r\n                container: document.getElementById('lottery-prepare'),\r\n                renderer: 'svg',\r\n                loop: true,\r\n                autoplay: true\r\n            });\r\n            this.lottery_start = lottie.loadAnimation({\r\n                path: \"static/gacha02.json\",\r\n                container: document.getElementById('lottery-start'),\r\n                renderer: 'svg',\r\n                loop: false,\r\n                autoplay: false\r\n            });\r\n            this.lottery_start.setSpeed(1.25);\r\n            this.lottery_start.onComplete = function() {\r\n                console.log('complete');\r\n                vm.stage = 'result';\r\n            }\r\n            axios.defaults.headers.common['Authorization'] = 'Bearer 1234';\r\n\r\n            document.addEventListener('keydown', function(event) {\r\n                console.log(event.keyCode);\r\n                if (event.keyCode === 13) {\r\n                    vm.start_draw();\r\n                }\r\n            });\r\n\r\n            this.get_options();\r\n        },\r\n        get_start() {\r\n            this.stage = 'start';\r\n            this.lottery_start.play();\r\n            this.get_options();\r\n        },\r\n        reset() {\r\n            this.stage = 'prepare';\r\n            this.lottery_start.stop();\r\n            this.award_id = null;\r\n            this.ajax_wait = false;\r\n        },\r\n        skip_anime() {\r\n            this.stage = 'result';\r\n            this.lottery_start.stop();\r\n        },\r\n        get_options() {\r\n            var vm = this;\r\n            // return;\r\n            axios.post(`${this.api_host}/getDrawConfigList`).then(response => {\r\n                vm.select_options = response.data.data;\r\n                console.log(response.data);\r\n            }).catch(err => {\r\n                alert(err);\r\n            })\r\n        },\r\n        display_prev() {\r\n            this.stage = 'result';\r\n        },\r\n        start_draw() {\r\n            // prevent double click\r\n            if (this.ajax_wait) {\r\n                return;\r\n            }\r\n            if (this.stage !== 'prepare') {\r\n                return;\r\n            }\r\n            if (this.event_type === 'regular' && !this.award_id) {\r\n                alert('尚未選擇抽獎項目');\r\n                return;\r\n            }\r\n            switch (this.event_type) {\r\n                case 'regular':\r\n                    this.call_draw_api();\r\n                    break;\r\n                case 'addition':\r\n                    this.call_addition_api();\r\n                    break;\r\n            }\r\n\r\n        },\r\n        call_draw_api() {\r\n            var vm = this;\r\n            vm.get_start();\r\n            // return;\r\n            this.ajax_wait = true;\r\n            axios.post(`${this.api_host}/drawWithConfigID`, {configID: this.award_id}).then(response => {\r\n                // console.log(response);\r\n                var data = response.data;\r\n                if (data.message) {\r\n                    alert(data.message);\r\n                } else {\r\n                    vm.award_name = data.data.prizeTitle;\r\n                    vm.lucky_list = data.data.nameList;\r\n                    vm.get_start();\r\n                }\r\n                this.ajax_wait = false;\r\n            }).catch(err => {\r\n                this.ajax_wait = false;\r\n                console.error(err);\r\n            })\r\n        },\r\n        call_addition_api() {\r\n            var vm = this;\r\n            this.ajax_wait = true;\r\n            axios.post(`${this.api_host}/drawAdditional`).then(response => {\r\n                // console.log(response);\r\n                var data = response.data;\r\n                if (data.message) {\r\n                    alert(data.message);\r\n                } else {\r\n                    vm.award_name = data.data.prizeTitle;\r\n                    vm.lucky_list = data.data.nameList;\r\n                    vm.get_start();\r\n                }\r\n                this.ajax_wait = false;\r\n            }).catch(err => {\r\n                this.ajax_wait = false;\r\n                console.error(err);\r\n            })\r\n        },\r\n        call_reset_api() {\r\n            var vm = this;\r\n            var callback = function() {\r\n                axios.post(`${vm.api_host}/resetDraw`).then(response => {\r\n                    var data = response.data;\r\n                    if (data.message) {\r\n                        alert(data.message);\r\n                    }\r\n                });\r\n            }\r\n            var confirm = window.confirm('是否確認要重置獎項?');\r\n            if (confirm) {\r\n                callback();\r\n            }\r\n        }\r\n    },\r\n    mounted: function() {\r\n        var host = window.localStorage.getItem('api_host');\r\n        if (host) {\r\n            this.api_host = host;\r\n        }\r\n        this.init();\r\n        this.is_ready = true;\r\n    }\r\n})\r\n"]}